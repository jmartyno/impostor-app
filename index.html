<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IMPOSTOR</title>
<link rel="manifest" href="manifest.json">

<style>
    body { font-family: Arial; text-align:center; padding:20px; background:#f0f8ff; }
    button { padding:15px; font-size:18px; margin-top:20px; width:80%; border-radius:12px; }
    #game { display:none; }
    #wordBox { font-size:32px; margin:30px 0; font-weight:bold; white-space:pre-line; }
    #pinBox { display:none; }
    #leyenda { 
        display:none;
        font-size:14px;
        margin-top:15px;
        padding:10px;
        color:#444;
        max-width:90%;
        margin-left:auto;
        margin-right:auto;
    }
</style>

<script>
// =============================
// LISTAS TEMÃTICAS
// =============================
const listas = {
    animales: ["PERRO","GATO","ELEFANTE","LEON","TIBURON","PINGÃœINO","CABALLO","JIRAFA","BABOSA","ESCORPION","RATA","ARAÃ‘A","CAMALEON","DRAGON","JABALI"],
    objetos: ["TECLADO","TELEVISOR","VENTILADOR","RELOJ","MOCHILA","TIJERAS","BOTELLA","LINTERNA","NEVERA","BOTELLA","TORNILLO","ALICATES","LIBRO","MOVIL"],
    profesiones: ["MEDICO","PILOTO","ABOGADO","CARPINTERO","MECANICO","PROFESOR","ENFERMERO","CAMARERO","INGENIERO","MUSICO","POLICIA","CONTABLE","YOUTUBER","INFLUENSER","POLITICO","METEOROLOGO","CIENTIFICO","FONTANERO"],
    acciones: ["CORRER","SALTAR","BOSTEZAR","ESCRIBIR","BESAR","SUSURRAR","NADAR","SALUDAR","CANTAR","ESTUDIAR","LEER","SOÃ‘AR","COSER","VOLAR","REIR","MIRAR","LLAMAR","INSULTAR","ODIAR"],
    comida: ["PIZZA","HAMBURGUESA","SUSHI","HELADO","PAELLA","TORTILLA","CHOCOLATE","PASTA","COCIDO","CROQUETAS","JAMON","MANZANA","SANDIA","MELON","NATILLAS","HELADO","TARTA"],
    marcas: ["NIKE","ADIDAS","ZARA","APPLE","TESLA","GUCCI","PRADA","SAMSUNG","BMW","MERCEDES","ROLEX","RAYBAN","CHANEL","COCACOLA","AMAZON","SPOTIFY","AUDI","LOEWE","BALENCIAGA","SAGAZMOBILITY","LATRAJERIA","SAGAZ","DUREX","PORSCHE"],
    personajes: ["PEDRO SANCHEZ","PABLO IGLESIAS","ERREJON","SANTIAGO ABASCAL","ALVISE","RAJOY","AZNAR","BISBAL","JUAN CARLOS I","FELIPE VI","YOLANDA DIAZ","IRENE MONTERO","FRANCO","MICKEL JACKSON","JUANA DE ARCO","PEPA PIG","JOSE LUIS ABALOS","POPEYE","OBELIX","EL CID","HITLER","LENIN","RAPHAEL","JULIO IGLESIAS","EINSTEIN","CLEOPATRA","JULIO CESAR","DIOS","MICKEY MOUSE","NADAL","MICKEL JORDAN","BILL GATES","ELON MUSK","PICASSO"],
    adultos: ["SEXO","BORRACHO","RESACA","CORNUDO","ORGASMO","CULO","EMPALMADO","PUTICLUB","69","DESEO","CONDON","PORNO","FETICHE","TRIO","GIGOLO","VICIO","PASION","TETAS","NINFOMANA","PUTA","COÃ‘O","POLLA"]
};

let roles = [];
let current = 0;
let adultosDesbloqueado = false;
const PIN_ADULTOS = "1234";

// =============================
// ASOCIAR EVENTOS A TODAS LAS CHECKBOX
// =============================
window.onload = function() {
    document.querySelectorAll(".temaCheck").forEach(cb => {
        cb.addEventListener("change", checkAdultos);
    });
};

// =============================
// CONTROL DE ADULTOS + PIN
// =============================
function checkAdultos() {
    const adultosCheck = document.querySelector('input[value="adultos"]');

    if (adultosCheck.checked && !adultosDesbloqueado) {
        document.getElementById("pinBox").style.display = "block";
        document.getElementById("pinInput").value = "";
    }

    if (!adultosCheck.checked) {
        document.getElementById("pinBox").style.display = "none";
    }
}

function validarPIN() {
    const adultosCheck = document.querySelector('input[value="adultos"]');
    const pin = document.getElementById("pinInput").value;

    if (pin === PIN_ADULTOS) {
        adultosDesbloqueado = true;
        alert("TemÃ¡tica ADULTOS desbloqueada");
        document.getElementById("pinBox").style.display = "none";
    } else {
        alert("PIN incorrecto");
        adultosCheck.checked = false;
        document.getElementById("pinBox").style.display = "none";
        adultosDesbloqueado = false;
    }
}

// =============================
// INICIAR JUEGO
// =============================
function startGame() {
    let p = parseInt(document.getElementById("players").value);
    let i = parseInt(document.getElementById("impostors").value);

    if (!p || !i) { alert("Rellena participantes e impostores"); return; }
    if (i >= p) { alert("Impostores debe ser menor que participantes"); return; }

    document.getElementById("tituloJuego").style.display = "none";
    document.getElementById("leyenda").style.display = "block";

    let seleccionados = [...document.querySelectorAll(".temaCheck:checked")].map(t => t.value);

    if (seleccionados.length === 0) {
        alert("Selecciona al menos una temÃ¡tica");
        return;
    }

    if (seleccionados.includes("adultos") && !adultosDesbloqueado) {
        alert("Debes introducir el PIN antes de jugar con Adultos.");
        return;
    }

    let bolsa = [];
    seleccionados.forEach(t => bolsa = bolsa.concat(listas[t]));

    const w = bolsa[Math.floor(Math.random() * bolsa.length)];

    roles = Array(p).fill(w);
    for (let x = 0; x < i; x++) roles[x] = "IMPOSTOR";

    roles.sort(() => Math.random() - 0.5);

    document.getElementById("setup").style.display = "none";
    document.getElementById("game").style.display = "block";

    updatePlayer();
}

// =============================
// SIGUIENTE JUGADOR
// =============================
function updatePlayer() {
    document.getElementById("playerNum").innerText = "Participante " + (current + 1);
    document.getElementById("wordBox").innerText = "";
    document.getElementById("showBtn").style.display = "inline-block";
    document.getElementById("nextBtn").style.display = "none";
}

// =============================
// MOSTRAR PALABRA
// =============================
function showWord() {
    const bop = new Audio("https://actions.google.com/sounds/v1/cartoon/boing.ogg");
    bop.play();

    let palabra = roles[current];

    if (palabra === "IMPOSTOR" && document.getElementById("pista").value === "si") {
        let seleccionados = [...document.querySelectorAll(".temaCheck:checked")].map(t => t.value);
        let bolsa = [];
        seleccionados.forEach(t => bolsa = bolsa.concat(listas[t]));
        let pista = bolsa[Math.floor(Math.random() * bolsa.length)];
        palabra = "IMPOSTOR\n(PISTA: " + pista + ")";
    }

    document.getElementById("wordBox").innerText = palabra;
    document.getElementById("showBtn").style.display = "none";
    document.getElementById("nextBtn").style.display = "inline-block";
}

// =============================
// SIGUIENTE O FIN DEL JUEGO
// =============================
function nextPlayer() {
    current++;

    if (current >= roles.length) {
        document.getElementById("wordBox").innerText = "";
        document.getElementById("showBtn").style.display = "none";
        document.getElementById("nextBtn").style.display = "none";
        document.getElementById("leyenda").style.display = "none";

        document.getElementById("playerNum").innerText = "";
        document.getElementById("wordBox").innerText = "Â¡A JUGAR!";
        document.getElementById("wordBox").style.fontSize = "40px";
        document.getElementById("wordBox").style.color = "#008000";

        setTimeout(() => location.reload(), 2000);
        return;
    }

    updatePlayer();
}

// =============================
// SERVICE WORKER
// =============================
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
}
</script>
</head>

<body>

<h2 id="tituloJuego">IMPOSTOR</h2>

<div id="setup">

    <label>NÂº Participantes:</label><br>
    <input id="players" type="number"><br><br>

    <label>NÂº Impostores:</label><br>
    <input id="impostors" type="number"><br><br>

    <label>TemÃ¡ticas (puedes elegir varias):</label><br><br>

    <div style="text-align:left; display:inline-block;">
        <label><input type="checkbox" class="temaCheck" value="animales"> Animales</label><br>
        <label><input type="checkbox" class="temaCheck" value="objetos"> Objetos</label><br>
        <label><input type="checkbox" class="temaCheck" value="profesiones"> Profesiones</label><br>
        <label><input type="checkbox" class="temaCheck" value="acciones"> Acciones</label><br>
        <label><input type="checkbox" class="temaCheck" value="comida"> Comida</label><br>
        <label><input type="checkbox" class="temaCheck" value="marcas"> Marcas</label><br>
        <label><input type="checkbox" class="temaCheck" value="personajes"> Personajes</label><br>
        <label><input type="checkbox" class="temaCheck" value="adultos"> Adultos ðŸ”’</label><br>
    </div>
    <br><br>

    <div id="pinBox">
        <label>Introduce PIN:</label><br>
        <input id="pinInput" type="password">
        <button onclick="validarPIN()">OK</button>
        <br><br>
    </div>

    <label>Â¿Dar pista al impostor?</label><br>
    <select id="pista">
        <option value="no">No</option>
        <option value="si">SÃ­</option>
    </select>
    <br><br>

    <button onclick="startGame()">Comenzar</button>
</div>

<div id="game">
    <h3 id="playerNum"></h3>
    <div id="wordBox"></div>

    <button id="showBtn" onclick="showWord()">Mostrar palabra</button>
    <button id="nextBtn" onclick="nextPlayer()" style="display:none;">Pasar mÃ³vil</button>

    <div id="leyenda">
        TendrÃ¡s que decir palabras relacionadas con la que ves arriba, pero nunca decirla directamente.
        SÃ© ingenioso porque el impostor podrÃ­a detectarlo... Â¡y estaremos perdidos!
    </div>
</div>

</body>
</html>
